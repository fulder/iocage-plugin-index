freebsd_instance:
  image_family: freebsd-12-2
  cpu: 1

install_backuppc_task:
  install_script: pkg install -y jq
  test_script: |
    plugin_file=backuppc.json
    release=$(jq -r '.release' $plugin_file)
    name=$(jq '.name' $plugin_file)
    packagesite=$(jq '.packagesite' $plugin_file)

    major_freebsd_release=$(freebsd-version | cut -d "." -f1)
    export ABI="FreeBSD:${major_freebsd_release}:amd64"
    export PACKAGESITE=${packagesite}

    echo "Testing install plugin pkgs for plugin: $name"

    pkgs=$(jq -r '.pkgs[]' $plugin_file)
    echo "Installing $name pkgs: $pkgs"
    pkg install -y $pkgs
